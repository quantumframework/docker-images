DOCKER_REGISTRY=docker.io
DOCKER_REPOSITORY=
DOCKER_IMAGE_NAME=postgresql:provision
ifneq ($(DOCKER_REPOSITORY),)
DOCKER_QUALNAME=$(DOCKER_REGISTRY)/$(DOCKER_REPOSITORY)/$(DOCKER_IMAGE_NAME)
endif

image:
	@docker build -t $(DOCKER_IMAGE_NAME) .
ifdef DOCKER_QUALNAME
	@docker tag $(DOCKER_IMAGE_NAME) $(DOCKER_QUALNAME)
else
	@echo "Use the DOCKER_REPOSITORY variable to specify a repository."
endif

publish:
	make image DOCKER_REGISTRY=$(DOCKER_REGISTRY)\
		DOCKER_REPOSITORY=$(DOCKER_REPOSITORY)
	docker push $(DOCKER_QUALNAME)